<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enneper - Animaciones Superficies </title>
    <!-- Otras etiquetas head... -->
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <!-- Otras etiquetas head... -->
    <link href="./styles2.css" rel="stylesheet" />
</head>
<body>
<div class="background"></div>
<nav class="navbar">
    <img class="navbar-logo" src="./assets/logo.png" />
    <input type="text" placeholder="Clic aí ->" class="navbar-search" readonly />
</nav>
<button class="navbar-burger" onclick="toggleMenu()"></button>
<nav class="menu">
    <a href="index.html" style="animation-delay: 0.0s">Selecciona unha:</a>
    <a href="ToroBoy.html" style="animation-delay: 0.1s">Toro de Boy</a>
    <a href="ToroClifford.html" style="animation-delay: 0.2s">Toro de Clifford</a>
    <a href="Enneper.html" style="animation-delay: 0.3s">Sup. Enneper</a>
    <a href="Scherk.html" style="animation-delay: 0.4s">Sup. Scherk</a>
    <a href="OndaEsferica.html" style="animation-delay: 0.5s">Onda Estanque</a>
    <a href="BotellaKlein.html" style="animation-delay: 0.6s">Botella de Klein</a>
    <a href="BandaMobius.html" style="animation-delay: 0.7s">Banda de Mobius</a>
</nav>

<!-- Combo box for selecting surface -->
<select id="surface-select">   <!-- onchange="changeSurface()"> -->
    <option value="klein">Botella de Klein</option>
    <option value="airy">Sombreiro Mexicano</option>
    <option value="clifford">Toro de Clifford</option>
</select>

<!-- Combo box for selecting materials -->
<select id="material-select">  <!-- onchange="changeMaterial()"> -->
    <option value="basico" selected>Material Básico</option>
    <option value="textura">Material Textura</option>
    <option value="wireframe">Wireframe</option>
    <option value="basicoazul">Básico Azul</option>
</select>

<!-- Combo box for selecting textures -->
<select id="texture-select" disabled> <!-- onchange="changeTexture()"> -->
    <option value="Julieta.jpg">Julieta</option>
    <option value="Perfil.jpg">Perfil</option>
    <option value="Avion.jpg">Avion</option>
    <!-- Agrega aquí las opciones para todas las imágenes disponibles en la carpeta "textures" -->
</select>


<div id="canvas-container">
    <script src="Three.js"></script>
    <script type="module">
        let scene, camera, renderer;
        let surfaceMesh;
        let isAnimationPaused = false;
        let animationId;
 
        var primerSelect = document.getElementById("primerSelect");
  var segundoSelect = document.getElementById("segundoSelect");

  /*
  if (primerSelect.value === "opcion2") {
    segundoSelect.disabled = false;
  } else {
    segundoSelect.disabled = true;
    // Establecer la opción D como la opción seleccionada por defecto cada vez que se desactiva el segundo select
    segundoSelect.selectedIndex = 3;
  }
 
 */
        function mostrarComboTextura() {
            var primerCombo = document.getElementById("material-select");
            var segundoCombo = document.getElementById("texture-select");
  
            if (primerCombo.value === "textura") {
                segundoCombo.disabled = false;
            } else {
                segundoCombo.disabled = true;
            //    segundoSelect.selectedIndex = 0;
            }
        }

        import { OrbitControls }  from './orbitcontrols.js';
  
        // Initialize Three.js scene
        function init() {
         
            // Create a scene
            scene = new THREE.Scene();

            // Create a camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Create a renderer
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Add fog to the scene
            const fogColor = 0x000090;
            const fogNear = 2.2;
            const fogFar = 5;
            scene.fog = new THREE.Fog(fogColor, fogNear, fogFar);
            //scene.fog = null;
            // Create initial geometry (Scherk surface)
            
    // Create the Clifford Torus geometry
            const geometry = new THREE.ParametricGeometry((u, v, target) => {
                const scale = 1.36;

                const a = 1.0;
                const b = 0.5;

                u = (u - 0.0) * 2 * Math.PI;
                v = (v - 0.0) * 2 * Math.PI;

                const x = scale * (a + b * Math.cos(v)) * Math.cos(u);
                const y = scale * (a + b * Math.cos(v)) * Math.sin(u);
                const z = scale * (b * Math.sin(v) +
                        2 * a * Math.sin(0.5 * v) * Math.sin(0.5 * v));
                 target.set(x, y, z);
               }, 100, 100);

            
            // Create a texture loader
            const textureLoader = new THREE.TextureLoader();

            // Load the texture
            const texture = textureLoader.load('./textures/Perfil.jpg');

            // Create material with the loaded texture
            
            const material = new THREE.MeshBasicMaterial(); // { map: texture }


            // Create mesh with the new material and geometry
            surfaceMesh = new THREE.Mesh(geometry, material);

            // Add the mesh to the scene
            scene.add(surfaceMesh);

            // Modificar el estilo CSS para ocultar las barras de desplazamiento
            document.body.style.margin = '0';
            document.body.style.overflow = 'hidden';

            // Add event listener for window resizing
            window.addEventListener('resize', onWindowResize, false);

            // Set the controls for the heart of the sun
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.1;


            /*
            // Add a click event listener to the renderer's DOM element
            renderer.domElement.addEventListener('click', () => {
                // Toggle animation pause and resume
                if (isAnimationPaused) {
                    animate();
                } else {
                    cancelAnimationFrame(animationId); // Pause the animation
                }
                isAnimationPaused = !isAnimationPaused;
            });
            */

        }

        // Animation loop
        function animate() {
            animationId = requestAnimationFrame(animate);

            // Rotate the surface
            surfaceMesh.rotation.x += 0.01;
            surfaceMesh.rotation.y += 0.01;

            renderer.render(scene, camera);
        }

        // Start the animation
        init();
        animate();

        // Handle window resize
        function onWindowResize() {
            const newWidth = window.innerWidth;
            const newHeight = window.innerHeight - 20;

            camera.aspect = newWidth / newHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(newWidth, newHeight);
        }

        // Function to change surface based on selection
        function changeSurface() {
            const surfaceSelect = document.getElementById('surface-select');
            const selectedSurface = surfaceSelect.value;

            // Remove existing surface
            scene.remove(surfaceMesh);

            // Create geometry based on selection
            let geometry;
            if (selectedSurface === 'klein') {
                // Create the Botella de Klein surface geometry
            //    geometry = new THREE.BoxGeometry(2.5,2.5,2.5);
                
                   // Create the Klein surface geometry
                geometry = new THREE.ParametricGeometry((u, v, target) => {
                    const scale = 0.68;

                    // Limit u and v to the range (0, 2*PI) y (0, 2*PI)
                    u = (u - 0.0) * 2 * Math.PI;
                    v = (v - 0.0) * 2 * Math.PI;

                    const x = scale * (3 + Math.cos(u / 2) * Math.sin(v) - Math.sin(u / 2) * Math.sin(2 * v)) * Math.cos(u);
                    const y = scale * (3 + Math.cos(u / 2) * Math.sin(v) - Math.sin(u / 2) * Math.sin(2 * v)) * Math.sin(u);
                    const z = scale * (Math.sin(u / 2) * Math.sin(v) + Math.cos(u / 2) * Math.sin(2 * v));

                    target.set(x, y, z);

                }, 100, 100);

                //alert("hola");
                //init();
                //animate();
                
            } else if (selectedSurface === 'airy') {

    // Create the Airy surface geometry
                geometry = new THREE.ParametricGeometry((u, v, target) => {
                    const scale = 1.68;

                    u = (u - 0.5) * 2 * 5;
                    v = (v - 0.5) * 2 * 5;

                    const x = scale * u;
                    const y = scale * v;
                    var  r = Math.sqrt(x * x + y * y); 
                    const z = scale * 2 * (Math.sin(Math.PI * r) / (Math.PI * r));

                    target.set(x, y, z);
                }, 200, 200);




// Create the Airy surface geometry


            } else if (selectedSurface === 'clifford') {
                //Create the Clifford Torus geometry
                geometry = new THREE.ParametricGeometry((u, v, target) => {
                    const scale = 0.6;

                    const R = 3;
                    const r = 1;
                    const k = 0.5;

                    u = (u - 0.0) * 2 * Math.PI;
                    v = (v - 0.0) * 2 * Math.PI;

                    const x = scale * (R + r * Math.cos(v)) * Math.cos(u);
                    const y = scale * (R + r * Math.cos(v)) * Math.sin(u);
                    const z = scale * r * Math.sin(v) * (1 + k * u);
                    target.set(x, y, z);
                }, 100, 100);
            // alert('hola clifford');

            }

            const textureLoader = new THREE.TextureLoader();

            // Load the texture
            const texture = textureLoader.load('./textures/Perfil.jpg');

            // Create material with the loaded texture
            const material = new THREE.MeshBasicMaterial({ map: texture });


            // Create mesh with the new material and geometry
            surfaceMesh = new THREE.Mesh(geometry, material);

            // Add the mesh to the scene
            scene.add(surfaceMesh);

            // Update material and texture based on selections
            changeMaterial();
          //  changeTexture();
        }

        // Function to change material based on selection
        function changeMaterial() {
            const materialSelect = document.getElementById('material-select');
            const selectedMaterial = materialSelect.value;
            
            const textureSelect = document.getElementById('texture-select');
            const selectedTexture = textureSelect.value;
            const textureLoader = new THREE.TextureLoader();
            const texture = textureLoader.load('./textures/' + selectedTexture);




            let material;
            mostrarComboTextura();
            // Choose material based on selection
            switch (selectedMaterial) {
                case 'basico':
                    material = new THREE.MeshBasicMaterial({ color: 0xffffff });
                    break;
                case 'textura':
                    // changeTexture();
                    // alert('entra!');
                    material = new THREE.MeshBasicMaterial({ map: texture , color: 0xffffff });
                    //surfaceMesh.material.color = 0xffffff;
                    break;
                case 'wireframe':
                    material = new THREE.MeshNormalMaterial({ wireframe: true , color: 0x00ff00 });
                    break;
                case 'basicoazul':
                    material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });// Lambert
                    // material.color = 0x0000ff;
                    break;
                default:
                    material = new THREE.MeshBasicMaterial();
                    break;
            }
            
            // Apply the selected material to the surface mesh
            surfaceMesh.material = material;
         //   surfaceMesh.material.needsUpdate = true;
        
        }


        // Call changeMaterial function when the selection changes
        document.getElementById("surface-select").addEventListener("change", changeSurface);

        // Call changeMaterial function when the selection changes
        document.getElementById("material-select").addEventListener("change", changeMaterial);


        // Function to change texture based on selection
        function changeTexture() {
            const textureSelect = document.getElementById('texture-select');
            const selectedTexture = textureSelect.value;
            const textureLoader = new THREE.TextureLoader();
            const texture = textureLoader.load('./textures/' + selectedTexture);
            
            //material.color = 0xffffff;
            surfaceMesh.material.map = texture;
            surfaceMesh.material.needsUpdate = true;
        
        }

        // Call changeMaterial function when the selection changes
        document.getElementById("texture-select").addEventListener("change", changeTexture);



</script>
</div>
</body>
</html>
